---
title: "Slicr and DiceR Project 1"
author: "Spencer Abbot, Chi Cheung, Eric Goldman"
date: "10/4/2017"
output: html_document
---
TEST - EG
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results = TRUE)

#Set Working Directory
#setwd("/Users/Spencer/Project_1")
setwd("/Users/ericg/Desktop/DATS 6101/GITHUB/Project_1")
#setwd("/Users/Chidog/Project_1")
```

```{r map, eval=TRUE}
#install maps package
install.packages("maps", repos="http://cran.rstudio.com/")
install.packages("ggplot2", repos="http://cran.rstudio.com/")
# call library for maps and plotting already installed 
library(ggplot2)
library(maps)


#US map - data
all_states <- map_data("state")

#Read in Lat Long Data from City
citylatlong <- data.frame(read.csv("citylatlong.csv"))

#plot US states with ggplot
p <- ggplot()
p <- p + geom_polygon( data=all_states, 
aes(x=long, y=lat, group = group),colour="white", fill="grey10" )
p;

# plot data points (lat/long) to US map
p + geom_point(data=citylatlong, 
aes(y=LAT, x=LONG, color=Population, size=Population)) +
  ggtitle("US Metro Statistical Areas with Population over 1 million")+
    theme_bw() +
  theme( plot.title=element_text(hjust=0.5),
         axis.line = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank(),
    axis.text.y =element_blank(),
    axis.text.x=element_blank(),
    axis.ticks.y=element_blank(),
    axis.ticks.x=element_blank()) +
    xlab("") + 
    ylab("")
```

```{r citystats}
#read in city data csv
library(stats)
citydata <- data.frame(read.csv("CityData.csv"))
head(citydata)
str(citydata)
summary(citydata)
#gather stats for citydata
install.packages("pastecs", repos="http://cran.rstudio.com/")
library(pastecs)
stat.desc(citydata)
hist(citydata$ZillowHVI)
boxplot(citydata$CrimeIndex)
boxplot(citydata$Amazon_HQIndex~citydata$MLB_Team)
hist(citydata$Amazon_HQIndex)
```

```{r anova}
#citydata$F500_HQ <- as.factor(citydata$F500_HQ)
plot(Amazon_HQIndex ~ F500_HQ, data=citydata)
model.degree <- aov(Amazon_HQIndex~MLB_Team, data = citydata)
hist(model.degree$residuals, main = "Hist of Res", xlab = "Residuals")
summary(model.degree)
TukeyHSD(model.degree)
plot(citydata)
plot(citydata$Amazon_HQIndex, citydata$CrimeIndex)
cor(citydata$ZillowHVI,citydata$CollegeDegree, method="pearson")
cor(citydata$Amazon_HQIndex,citydata$Population, method="pearson")
cor(citydata[,2:8], method="pearson")
qqnorm(citydata[,8], main="Amazon Index Score Q-Q Plot")
qqline (citydata[,8], col=2)
shapiro.test(citydata$Amazon_HQIndex)
shapiro.test(model.degree$residuals)
```

Handy Outlier Function

```{r, eval=TRUE}
outlierKD <- function(dt, var) {
     var_name <- eval(substitute(var),eval(dt))
     na1 <- sum(is.na(var_name))
     m1 <- mean(var_name, na.rm = T)
     par(mfrow=c(2, 2), oma=c(0,0,3,0))
     boxplot(var_name, main="With outliers")
     hist(var_name, main="With outliers", xlab=NA, ylab=NA)
     outlier <- boxplot.stats(var_name)$out
     mo <- mean(outlier)
     var_name <- ifelse(var_name %in% outlier, NA, var_name)
     boxplot(var_name, main="Without outliers")
     hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
     title("Outlier Check", outer=TRUE)
     na2 <- sum(is.na(var_name))
     cat("Outliers identified:", na2 - na1, "n")
     cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "n")
     cat("Mean of the outliers:", round(mo, 2), "n")
     m2 <- mean(var_name, na.rm = T)
     cat("Mean without removing outliers:", round(m1, 2), "n")
     cat("Mean if we remove outliers:", round(m2, 2), "n")
     response <- readline(prompt="Do you want to remove outliers and to replace with NA? [yes/no]: ")
     if(response == "y" | response == "yes"){
          dt[as.character(substitute(var))] <- invisible(var_name)
          assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
          cat("Outliers successfully removed", "n")
          return(invisible(dt))
     } else{
          cat("Nothing changed", "n")
          return(invisible(var_name))
     }
}
outlierKD(citydata, Amazon_HQIndex)
```

```{r, eval=TRUE}
x <- lm(Population~F500_HQ, data = citydata)
summary(x)

```
